#!/usr/bin/env sh
set -e

echo '---- Cleaning up old files ----'
rm -rf app/assets coverage spec/dummy/log spec/dummy/storage spec/dummy/tmp

echo '---- Installing dependencies ----'
bun i
bundle
bundle exec appraisal install

echo '---- Building assets ----'
bun run build

echo '---- Setting up database ----'
if [ -n "$CI" ]; then
  bundle exec rails db:schema:load 
else
  bundle exec rails db:reset db:schema:load 
  RAILS_ENV=development bundle exec rails db:seed
fi
